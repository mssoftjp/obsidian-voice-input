# Voice Input Processing Flow / éŸ³å£°å…¥åŠ›å‡¦ç†ãƒ•ãƒ­ãƒ¼

This document describes the current processing pipeline of the voice input system. As of 2025-08-15, the cleaning stage first strips TRANSCRIPT wrappers mechanically, then runs a safetyâ€‘guarded cleaning pipeline, and finally applies optional dictionary correction.

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯æœ€æ–°ã®éŸ³å£°å…¥åŠ›å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’èª¬æ˜ã—ã¾ã™ã€‚2025-08-15 æ™‚ç‚¹ã§ã¯ã€ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ®µéšã§ã¾ãšæ©Ÿæ¢°çš„ã« TRANSCRIPT ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’é™¤å»ã—ã€ãã®å¾Œã«å®‰å…¨è£…ç½®ä»˜ãã®ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã€æœ€å¾Œã«è¾æ›¸è£œæ­£ï¼ˆä»»æ„ï¼‰ã‚’é©ç”¨ã—ã¾ã™ã€‚

## Updated Overview (Current) / æœ€æ–°ã®æ¦‚è¦

1) Audio â†’ OpenAI Transcription APIï¼ˆè¨€èªã”ã¨ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä»˜ä¸ã¯æ—¥æœ¬èªã®ã¿ï¼‰ã€‚
2) APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ `text` ã‚’å—é ˜ã€‚
3) æ§‹é€ é™¤å»ï¼ˆäº‹å‰å‡¦ç†ï¼‰: `<TRANSCRIPT ...> ... </TRANSCRIPT>` ã‚’æ©Ÿæ¢°çš„ã«æŠ½å‡ºãƒ»é™¤å»ï¼ˆé–‰ã˜ã‚¿ã‚°æ¬ è½ã«ã‚‚å¯¾å¿œï¼‰ã€‚
4) ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œï¼ˆ`StandardCleaningPipeline`ï¼‰
   - `PromptContaminationCleaner`: æŒ‡ç¤ºæ–‡ãƒ»XML/æ–‡è„ˆã‚¿ã‚°ãƒ»ã‚¹ãƒ‹ãƒšãƒƒãƒˆãªã©ã®æ··å…¥é™¤å»ã€‚
   - `UniversalRepetitionCleaner`: åå¾©æŠ‘åˆ¶ï¼ˆæ–‡å­—/ãƒˆãƒ¼ã‚¯ãƒ³/æ–‡/åˆ—æŒ™/æ®µè½/æœ«å°¾ï¼‰ï¼‹æœ€çµ‚æ•´å½¢ã€‚
   - ã‚»ãƒ¼ãƒ•ãƒ†ã‚£: ã‚¯ãƒªãƒ¼ãƒŠãƒ¼å˜ä½“ã®å‰Šæ¸›ç‡ä¸Šé™ï¼‹ç·Šæ€¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‚æ§‹é€ é™¤å»ã¯éå‰°ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’é¿ã‘ã‚‹ãŸã‚ç·©å’Œã‚ã‚Šã€‚
5) ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ©ãƒ¼æ¤œå‡ºï¼ˆç„¡éŸ³æ™‚ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¿”ã‚‹ç­‰ï¼‰â†’ è©²å½“ã™ã‚Œã°ç©ºæ–‡å­—ã§æ—©æœŸçµ‚äº†ã€‚
6) è¾æ›¸è£œæ­£ï¼ˆä»»æ„ï¼‰: `DictionaryCorrector` ã«ã‚ˆã‚‹èªå½™ä¿®æ­£ã€‚
7) æœ€çµ‚ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿”å´ã€‚

## Complete Processing Flow / å®Œå…¨ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Audio Input    â”‚ ğŸ¤
â”‚  éŸ³å£°å…¥åŠ›       â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Audio Blob     â”‚
â”‚  Creation       â”‚
â”‚  éŸ³å£°Blobä½œæˆ   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                TranscriptionService.transcribe()            â”‚
â”‚                æ–‡å­—èµ·ã“ã—ã‚µãƒ¼ãƒ“ã‚¹                           â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Language Check  â”‚â”€â”€â”€â”€â”‚ buildTranscriptionPrompt(language)  â”‚
â”‚ è¨€èªãƒã‚§ãƒƒã‚¯    â”‚    â”‚ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰                      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                   â”‚
      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ â”‚                                 â”‚                  â”‚
      â”‚ â”‚ IF language === 'ja'            â”‚                  â”‚
      â”‚ â”‚ æ—¥æœ¬èªã®å ´åˆ:                   â”‚                  â”‚
      â”‚ â”‚                                 â–¼                  â”‚
      â”‚ â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚ â”‚     â”‚ ä»¥ä¸‹ã®éŸ³å£°å†…å®¹ã®ã¿ã‚’æ–‡å­—ã«èµ·ã“ã—ã¦ãã ã•ã„ â”‚   â”‚
      â”‚ â”‚     â”‚ ã“ã®æŒ‡ç¤ºæ–‡ã¯å‡ºåŠ›ã«å«ã‚ãªã„ã§ãã ã•ã„      â”‚   â”‚
      â”‚ â”‚     â”‚ è©±è€…ã®ç™ºè¨€å†…å®¹ã ã‘ã‚’æ­£ç¢ºã«è¨˜éŒ²ã—ã¦ãã ã•ã„ â”‚   â”‚
      â”‚ â”‚     â”‚                                           â”‚   â”‚
      â”‚ â”‚     â”‚ å‡ºåŠ›å½¢å¼:                                â”‚   â”‚
      â”‚ â”‚     â”‚ <TRANSCRIPT>                              â”‚   â”‚
      â”‚ â”‚     â”‚ ï¼ˆè©±è€…ã®ç™ºè¨€ã®ã¿ï¼‰                       â”‚   â”‚
      â”‚ â”‚     â”‚ </TRANSCRIPT>                             â”‚   â”‚
      â”‚ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚ â”‚                                 â”‚                  â”‚
      â”‚ â”‚ ELSE (en/zh/ko/auto)            â”‚                  â”‚
      â”‚ â”‚ ãã®ä»–ã®è¨€èª:                   â”‚                  â”‚
      â”‚ â”‚                                 â–¼                  â”‚
      â”‚ â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚ â”‚     â”‚ No Prompt Added                           â”‚   â”‚
      â”‚ â”‚     â”‚ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¿½åŠ ãªã—                       â”‚   â”‚
      â”‚ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   OpenAI API Request                        â”‚
â”‚                   OpenAI API ãƒªã‚¯ã‚¨ã‚¹ãƒˆ                     â”‚
â”‚                                                             â”‚
â”‚  FormData:                                                  â”‚
â”‚  â”œâ”€ file: audio.webm (Blob)                                â”‚
â”‚  â”œâ”€ model: gpt-4o-transcribe / gpt-4o-mini-transcribe      â”‚
â”‚  â”œâ”€ response_format: json                                   â”‚
â”‚  â”œâ”€ temperature: 0                                          â”‚
â”‚  â”œâ”€ language: ja/en/zh/ko (if not 'auto')                  â”‚
â”‚  â””â”€ prompt: [Only for Japanese / æ—¥æœ¬èªã®ã¿]                â”‚
â”‚                                                             â”‚
â”‚  Headers:                                                   â”‚
â”‚  â””â”€ Authorization: Bearer ${apiKey}                         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   OpenAI API Response                       â”‚
â”‚                   OpenAI API ãƒ¬ã‚¹ãƒãƒ³ã‚¹                     â”‚
â”‚                                                             â”‚
â”‚  { text: "transcribed text...", language: "detected" }     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                cleanGPT4oResponse(text, language)           â”‚
â”‚                GPT-4oãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°                 â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Pre-strip TRANSCRIPT wrappers (mechanical extraction)  â”‚
â”‚      TRANSCRIPTãƒ©ãƒƒãƒ‘ãƒ¼ã®äº‹å‰é™¤å»ï¼ˆå®Œå…¨/ä¸å®Œå…¨ã«å¯¾å¿œï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            StandardCleaningPipelineï¼ˆå®‰å…¨åˆ¤å®šä»˜ãï¼‰          â”‚
â”‚            ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³                        â”‚
â”‚                                                             â”‚
â”‚  1) PromptContaminationCleaner                              â”‚
â”‚     - TRANSCRIPT/TRANSCRIPTIONã‚¿ã‚°æ®‹ç•™ã®é™¤å»                 â”‚
â”‚     - æŒ‡ç¤ºæ–‡ï¼ˆå®Œå…¨ä¸€è‡´/ã‚¹ãƒ‹ãƒšãƒƒãƒˆ/æ–‡è„ˆï¼‰é™¤å»                 â”‚
â”‚                                                             â”‚
â”‚  2) UniversalRepetitionCleaner                              â”‚
â”‚     - æ–‡å­—/è¨˜å·/ãƒˆãƒ¼ã‚¯ãƒ³/æ–‡/æ®µè½/åˆ—æŒ™/æœ«å°¾ã®åå¾©æŠ‘åˆ¶         â”‚
â”‚     - æœ€çµ‚æ•´å½¢ï¼ˆæ”¹è¡Œãƒ»ç©ºç™½ã®æ­£è¦åŒ–ãªã©ï¼‰                    â”‚
â”‚                                                             â”‚
â”‚  Safety / å®‰å…¨è£…ç½®:                                         â”‚
â”‚   - ã‚¯ãƒªãƒ¼ãƒŠãƒ¼å˜ä½“ã®å‰Šæ¸›ç‡ä¸Šé™ã€ç·Šæ€¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯             â”‚
â”‚   - æ§‹é€ é™¤å»ã®éå‰°ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å›é¿ï¼ˆç·©å’Œï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              isPromptErrorDetected(text, language)          â”‚
â”‚              ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ©ãƒ¼æ¤œå‡º                           â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ â”‚                                                     â”‚
      â”‚ â”‚ Check for prompt leakage patterns:                  â”‚
      â”‚ â”‚ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ¼æ´©ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯:                   â”‚
      â”‚ â”‚                                                     â”‚
      â”‚ â”‚ Japanese (ja):                                      â”‚
      â”‚ â”‚ â€¢ "ã“ã®æŒ‡ç¤ºæ–‡ã¯å‡ºåŠ›ã«å«ã‚ãªã„ã§ãã ã•ã„"           â”‚
      â”‚ â”‚ â€¢ "è©±è€…ã®ç™ºè¨€å†…å®¹ã ã‘ã‚’æ­£ç¢ºã«è¨˜éŒ²ã—ã¦ãã ã•ã„"     â”‚
      â”‚ â”‚ â€¢ "ï¼ˆè©±è€…ã®ç™ºè¨€ã®ã¿ï¼‰"                            â”‚
      â”‚ â”‚                                                     â”‚
      â”‚ â”‚ English (en):                                       â”‚
      â”‚ â”‚ â€¢ "Please transcribe only the speaker"             â”‚
      â”‚ â”‚ â€¢ "Do not include this instruction"                â”‚
      â”‚ â”‚ â€¢ "(Speaker content only)"                         â”‚
      â”‚ â”‚                                                     â”‚
      â”‚ â”‚ Chinese (zh):                                       â”‚
      â”‚ â”‚ â€¢ "è¯·ä»…è½¬å½•è¯´è¯è€…"                                  â”‚
      â”‚ â”‚ â€¢ "ä¸è¦åŒ…å«æ­¤æŒ‡ä»¤"                                  â”‚
      â”‚ â”‚ â€¢ "ï¼ˆä»…è¯´è¯è€…å†…å®¹ï¼‰"                               â”‚
      â”‚ â”‚                                                     â”‚
      â”‚ â”‚ Korean (ko):                                        â”‚
      â”‚ â”‚ â€¢ "í™”ìì˜ ë°œì–¸ë§Œ ì „ì‚¬í•´ì£¼ì„¸ìš”"                     â”‚
      â”‚ â”‚ â€¢ "ì´ ì§€ì‹œì‚¬í•­ì„ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”"                  â”‚
      â”‚ â”‚ â€¢ "ï¼ˆí™”ì ë°œì–¸ë§Œï¼‰"                               â”‚
      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ If prompt error â”‚ NO â”‚ Continue to dictionary processing    â”‚
â”‚ detected?       â”‚â”€â”€â”€â–¶â”‚ è¾æ›¸å‡¦ç†ã¸ç¶šè¡Œ                       â”‚
â”‚ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ©ãƒ¼â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ æ¤œå‡ºï¼Ÿ          â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
      â”‚ YES                               â”‚
      â–¼                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ Return empty    â”‚                       â”‚
â”‚ string          â”‚                       â”‚
â”‚ ç©ºæ–‡å­—ã‚’è¿”ã™    â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                                          â”‚
                                          â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ enableTranscriptionCorrection?     â”‚
                        â”‚ æ–‡å­—èµ·ã“ã—ä¿®æ­£ãŒæœ‰åŠ¹ï¼Ÿ             â”‚
                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ YES               â”‚ NO
                    â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ DictionaryCorrector.correct() â”‚   â”‚ Skip correction â”‚
    â”‚ è¾æ›¸ä¿®æ­£é©ç”¨                  â”‚   â”‚ ä¿®æ­£ã‚’ã‚¹ã‚­ãƒƒãƒ—  â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                   â”‚
          â–¼                                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ Apply multilingual corrections:       â”‚ â”‚
    â”‚ å¤šè¨€èªä¿®æ­£ã‚’é©ç”¨:                     â”‚ â”‚
    â”‚                                       â”‚ â”‚
    â”‚ 1. Default rules (empty by default)  â”‚ â”‚
    â”‚    ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«ï¼ˆæ—¢å®šã§ã¯ç©ºï¼‰     â”‚ â”‚
    â”‚                                       â”‚ â”‚
    â”‚ 2. Custom rules                       â”‚ â”‚
    â”‚    ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«                     â”‚ â”‚
    â”‚                                       â”‚ â”‚
    â”‚ 3. Dictionary corrections             â”‚ â”‚
    â”‚    è¾æ›¸ä¿®æ­£:                          â”‚ â”‚
    â”‚    â€¢ Fixed string replacements       â”‚ â”‚
    â”‚    â€¢ Applied to ALL languages        â”‚ â”‚
    â”‚    â€¢ å›ºå®šæ–‡å­—åˆ—ç½®æ›                  â”‚ â”‚
    â”‚    â€¢ å…¨è¨€èªã«é©ç”¨                    â”‚ â”‚
    â”‚                                       â”‚ â”‚
    â”‚ Examples:                             â”‚ â”‚
    â”‚ â€¢ "AI" â†’ "artificial intelligence"   â”‚ â”‚
    â”‚ â€¢ "ã“ã‚“ã«ã¡ã¯" â†’ "ã“ã‚“ã«ã¡ã¯ï¼ˆä¿®æ­£ï¼‰" â”‚ â”‚
    â”‚ â€¢ "ä½ å¥½" â†’ "æ‚¨å¥½"                     â”‚ â”‚
    â”‚ â€¢ "ì•ˆë…•" â†’ "ì•ˆë…•í•˜ì„¸ìš”"               â”‚ â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â”‚                                   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚           Final Output              â”‚
                â”‚           æœ€çµ‚å‡ºåŠ›                  â”‚
                â”‚                                     â”‚
                â”‚ TranscriptionResult {               â”‚
                â”‚   text: correctedText,              â”‚
                â”‚   originalText: originalText,       â”‚
                â”‚   duration: processingTime,         â”‚
                â”‚   model: "gpt-4o(-mini)-transcribe", â”‚
                â”‚   language: detectedLanguage        â”‚
                â”‚ }                                   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Differences by Language / è¨€èªã«ã‚ˆã‚‹ä¸»ãªé•ã„

### Japanese (ja) Processing / æ—¥æœ¬èªå‡¦ç†
1. **Prompt Addition**: Complex Japanese prompt with specific instructions
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¿½åŠ : ç‰¹å®šã®æŒ‡ç¤ºã‚’å«ã‚€è¤‡é›‘ãªæ—¥æœ¬èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
2. **Intensive Cleaning**: Multiple Japanese-specific patterns removed
   - é›†ç´„çš„ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°: è¤‡æ•°ã®æ—¥æœ¬èªç‰¹æœ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é™¤å»
3. **Error Detection**: Japanese prompt leakage patterns
   - ã‚¨ãƒ©ãƒ¼æ¤œå‡º: æ—¥æœ¬èªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ¼æ´©ãƒ‘ã‚¿ãƒ¼ãƒ³

### Other Languages (en/zh/ko) Processing / ãã®ä»–ã®è¨€èªå‡¦ç†
1. **No Prompt**: Direct transcription without additional prompts
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã—: è¿½åŠ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãªã—ã®ç›´æ¥æ–‡å­—èµ·ã“ã—
2. **Conservative Cleaning**: Only generic colon-based patterns
   - ä¿å®ˆçš„ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°: ã‚³ãƒ­ãƒ³ãƒ™ãƒ¼ã‚¹ã®æ±ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿
3. **Language-specific Error Detection**: Each language has its own patterns
   - è¨€èªå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼æ¤œå‡º: å„è¨€èªãŒç‹¬è‡ªã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒã¤

### Auto Language Processing / è‡ªå‹•è¨€èªå‡¦ç†
- Uses Japanese patterns as fallback for error detection
- ã‚¨ãƒ©ãƒ¼æ¤œå‡ºæ™‚ã¯æ—¥æœ¬èªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ä½¿ç”¨
- No prompt addition (treated as non-Japanese)
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¿½åŠ ãªã—ï¼ˆéæ—¥æœ¬èªã¨ã—ã¦æ‰±ã†ï¼‰

## Dictionary Processing / è¾æ›¸å‡¦ç†

Dictionary correction is **language-agnostic** and applies to all languages when enabled:
è¾æ›¸ä¿®æ­£ã¯**è¨€èªéä¾å­˜**ã§ã€æœ‰åŠ¹æ™‚ã¯å…¨è¨€èªã«é©ç”¨ã•ã‚Œã¾ã™:

```
Dictionary Entry: { from: ["AI"], to: "artificial intelligence" }
è¾æ›¸ã‚¨ãƒ³ãƒˆãƒª: { from: ["AI"], to: "artificial intelligence" }

Applied to:
é©ç”¨å¯¾è±¡:
âœ“ English: "AI system" â†’ "artificial intelligence system"
âœ“ Japanese: "AIã‚·ã‚¹ãƒ†ãƒ " â†’ "artificial intelligenceã‚·ã‚¹ãƒ†ãƒ "  
âœ“ Chinese: "AIç³»ç»Ÿ" â†’ "artificial intelligenceç³»ç»Ÿ"
âœ“ Korean: "AIì‹œìŠ¤í…œ" â†’ "artificial intelligenceì‹œìŠ¤í…œ"
```

## Processing Performance / å‡¦ç†æ€§èƒ½

The system logs detailed performance metrics:
ã‚·ã‚¹ãƒ†ãƒ ã¯è©³ç´°ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ã‚’ãƒ­ã‚°ã«è¨˜éŒ²ã—ã¾ã™:

- Audio blob size and type / éŸ³å£°Blobã‚µã‚¤ã‚ºã¨ã‚¿ã‚¤ãƒ—
- Processing duration / å‡¦ç†æ™‚é–“
- Original vs corrected text length / å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã¨ä¿®æ­£å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆé•·
- Model used and cost estimation / ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«ã¨ã‚³ã‚¹ãƒˆæ¨å®š

## Error Handling / ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

The system handles various error scenarios:
ã‚·ã‚¹ãƒ†ãƒ ã¯æ§˜ã€…ãªã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªã‚’å‡¦ç†ã—ã¾ã™:

1. **API Errors**: Invalid key, quota exceeded, network errors
   - API ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªã‚­ãƒ¼ã€ã‚¯ã‚©ãƒ¼ã‚¿è¶…éã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
2. **Prompt Leakage**: Detection and mitigation of prompt content in output
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ¼æ´©: å‡ºåŠ›å†…ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ã®æ¤œå‡ºã¨è»½æ¸›
3. **Empty Audio**: Graceful handling of silent or empty audio input
   - ç©ºéŸ³å£°: ç„¡éŸ³ã¾ãŸã¯ç©ºã®éŸ³å£°å…¥åŠ›ã®é©åˆ‡ãªå‡¦ç†

This visualization shows the complete flow from audio input to final transcribed and corrected text, highlighting the sophisticated language-specific processing that makes this plugin particularly effective for Japanese users while maintaining compatibility with other languages.

ã“ã®å¯è¦–åŒ–ã¯ã€éŸ³å£°å…¥åŠ›ã‹ã‚‰æœ€çµ‚çš„ãªæ–‡å­—èµ·ã“ã—ãƒ»ä¿®æ­£ãƒ†ã‚­ã‚¹ãƒˆã¾ã§ã®å®Œå…¨ãªãƒ•ãƒ­ãƒ¼ã‚’ç¤ºã—ã€ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ—¥æœ¬èªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç‰¹ã«åŠ¹æœçš„ã§ã‚ã‚ŠãªãŒã‚‰ä»–è¨€èªã¨ã®äº’æ›æ€§ã‚’ç¶­æŒã™ã‚‹æ´—ç·´ã•ã‚ŒãŸè¨€èªå›ºæœ‰å‡¦ç†ã‚’å¼·èª¿ã—ã¦ã„ã¾ã™ã€‚
